---
- hosts: all
  remote_user: root
  become: yes
  tasks:
    - name: Debian | ensure ntpd is at the latest version
      apt: pkg=ntp state=latest
      when: ansible_distribution == 'Debian' or ansible_distribution == 'Ubuntu'
      notify:
      - restart ntpd
    - name: RHEL | ensure ntpd is at the latest version
      yum: pkg=ntp state=latest
      when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux'
      notify:
      - restart ntpd
    - name: Create config file
      template:
        src: curator.yml.j2
        dest: /home/curator/curator.yml
  handlers:
    - name: RHEL | restart ntpd
      service: name=ntpd state=restarted
    - name: Debian | restart ntpd
      service: name=ntp state=restarted
  roles:
    - { role: geerlingguy.repo-epel, when: ansible_distribution == 'CentOS' or ansible_distribution == 'Red Hat Enterprise Linux' }
    - { role: geerlingguy.elasticsearch-curator }
